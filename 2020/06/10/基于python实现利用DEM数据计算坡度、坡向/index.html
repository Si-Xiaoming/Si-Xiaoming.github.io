<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>基于python实现利用DEM数据计算坡度、坡向</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h2><a id="_0"></a>基本概念</h2>
<p><strong>DEM数据</strong></p>
<pre><code>DataMark:CNSDTF-DEM
Version:1.0
Unit:M
Alpha:0.000000
Compress:0.000000
X0:258000.000
Y0:324000.000
DX:22.500
DY:22.500
Row:321
Col:481
ValueType:Integer
Hzoom:1000
 192743  191068  187814  181388  173357  165286  157185  152266  147335  142391 
 139052  137327  135608  130633  124014  117372  118908  123706  128495  133265 
 138026  139540  139440  139337  135994  131025  127669  124312  120947  119208 
 125633  135280  141643  149598  155913  160612  162106  163600  160300  160203 
 158500  156795  155094  151780  148466  143534  138590  133632  130287  126935 
 125208  126733  133122  136259  137773  139280  142407  143916  142199  142101 
</code></pre>
<p><strong>坡度</strong><br>
<img src="https://img-blog.csdnimg.cn/20200610233101124.png" alt="在这里插入图片描述"><br>
坡度是法线与铅垂线之间的夹角。如图2.2所示，利用坡度计算公式<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi><mo>=</mo><mi>a</mi><mi>r</mi><mi>c</mi><mi>t</mi><mi>a</mi><mi>n</mi><msqrt><mrow><msubsup><mi>f</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>f</mi><mi>y</mi><mn>2</mn></msubsup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\alpha=arctan \sqrt{f_x^2+f_y^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.0037em;">α</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.84em; vertical-align: -0.6765em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.1635em;"><span class="svg-align" style="top: -3.8em;"><span class="pstrut" style="height: 3.8em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.453em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.453em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.1235em;"><span class="pstrut" style="height: 3.8em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.88em;"><svg width="400em" height="1.8800000000000001em" viewBox="0 0 400000 1944" preserveAspectRatio="xMinYMin slice"><path d="M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.6765em;"><span class=""></span></span></span></span></span></span></span></span></span> ，进行求解。<br>
<strong>坡向</strong><br>
<img src="https://img-blog.csdnimg.cn/20200610233621788.png" alt="在这里插入图片描述"><br>
坡向是法线在水平面上的投影与正北方向之间的夹角（顺时针度量）。如图2.3所示，利用坡向计算公式<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mo>=</mo><mi>arctan</mi><mo>⁡</mo><mfrac><msub><mi>f</mi><mi>y</mi></msub><msub><mi>f</mi><mi>x</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">A = \arctan \frac{{f_y }}{{f_x }}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.47454em; vertical-align: -0.481108em;"></span><span class="mop">arctan</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.993428em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: -0.10764em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.50732em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: -0.10764em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.281886em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.481108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> ， 求解。</p>
<h2><a id="_29"></a>程序流程</h2>
<p><img src="https://img-blog.csdnimg.cn/20200610233919356.png" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/20200610233950490.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU2MTM1Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
2）计算各点梯度<br>
<img src="https://img-blog.csdnimg.cn/20200610234043841.png" alt="在这里插入图片描述"><br>
如图3.5所示，可以利用像下面的公式写一个函数进行计算，<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>l</mi><mi>o</mi><mi>p</mi><msub><mi>e</mi><mi>x</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>e</mi><mn>1</mn></msub><mo>−</mo><msub><mi>e</mi><mn>3</mn></msub></mrow><mrow><mn>2</mn><mo>×</mo><mi>d</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi>x</mi></mrow></mfrac>        <mi>s</mi><mi>l</mi><mi>o</mi><mi>p</mi><msub><mi>e</mi><mi>y</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>e</mi><mn>4</mn></msub><mo>−</mo><msub><mi>e</mi><mn>2</mn></msub></mrow><mrow><mn>2</mn><mo>×</mo><mi>d</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi>y</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">slope_x  = \frac{{e_1  - e_3 }}{{2 \times dsizex}}\;\;\;\;slope_y  = \frac{{e_4  - e_2 }}{{2 \times dsizey}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.22176em; vertical-align: -0.403331em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.818431em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">×</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.04398em;">z</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.403331em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.29954em; vertical-align: -0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.818431em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mbin mtight">×</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.04398em;">z</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317314em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.481108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br>
。首先计算3*3DEM格网数据的X,Y方向的变化。对于整幅图而言，由于本图像元点不是特别多，故对于边缘的点处理时，可以在栅格点外再加一圈栅格便于求梯度。而添加点的方式只需要把原本边缘的栅格点的高程值复制一遍即可，如图3.6所示。<br>
<img src="https://img-blog.csdnimg.cn/20200610234059566.png" alt="在这里插入图片描述"><br>
3)解算坡度、坡向<br>
如图3.5所示，可以利用下面的公式计算求得坡度和坡向<span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>l</mi><mi>o</mi><mi>p</mi><mo>=</mo><mi>arctan</mi><mo>⁡</mo><msqrt><mrow><mi>s</mi><mi>l</mi><mi>o</mi><mi>p</mi><msubsup><mi>e</mi><mi>x</mi><mn>2</mn></msubsup><mo>+</mo><mi>s</mi><mi>l</mi><mi>o</mi><mi>p</mi><msubsup><mi>e</mi><mi>y</mi><mn>2</mn></msubsup></mrow></msqrt>      <mi>A</mi><mo>=</mo><mi>arctan</mi><mo>⁡</mo><mfrac><mrow><mi>s</mi><mi>l</mi><mi>o</mi><mi>p</mi><msub><mi>e</mi><mi>y</mi></msub></mrow><mrow><mi>s</mi><mi>l</mi><mi>o</mi><mi>p</mi><msub><mi>e</mi><mi>x</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">slop = \arctan \sqrt {slope_x^2  + slope_y^2 } \;\;\;A = \arctan \frac{{slope_y }}{{slope_x }}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.84em; vertical-align: -0.6765em;"></span><span class="mop">arctan</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.1635em;"><span class="svg-align" style="top: -3.8em;"><span class="pstrut" style="height: 3.8em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.383108em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.1235em;"><span class="pstrut" style="height: 3.8em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.88em;"><svg width="400em" height="1.8800000000000001em" viewBox="0 0 400000 1944" preserveAspectRatio="xMinYMin slice"><path d="M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.6765em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathdefault">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.47454em; vertical-align: -0.481108em;"></span><span class="mop">arctan</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.993428em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">p</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.50732em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">p</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: 0em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.281886em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.481108em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>。在这一过程中可以整体进行计算，从而较为方便地获得坡度和坡向的二维矩阵。<br>
4)可视化<br>
利用python中的绘图库matplotlib，编写了一个可视化函数，利用plot里面的imshow，将之前计算得到的二维矩阵存进去，最后以栅格的方式显示。对于三维DEM显示，利用Axes3D的方法，利用DEM文件中的起始坐标和分辨率推算出各个栅格的坐标，对应出高程值，绘制出三维图形。</p>
<h2><a id="_42"></a>程序代码</h2>
<h3><a id="DEMclass_43"></a>DEMclass模块</h3>
<pre><code class="prism language-python"><span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> Axes3D
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> cbook
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> cm
<span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>colors <span class="token keyword">import</span> LightSource
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> re
<span class="token keyword">import</span> math
<span class="token comment">#####读取文件并处理成numpy并返回</span>
<span class="token keyword">def</span> <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'datas.DEM'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        datas <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    strs <span class="token operator">=</span> <span class="token string">""</span>
    row <span class="token operator">=</span> <span class="token number">321</span>
    col <span class="token operator">=</span> <span class="token number">481</span>
    npdata <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>int16<span class="token punctuation">)</span>
    <span class="token keyword">for</span> data <span class="token keyword">in</span> datas<span class="token punctuation">:</span>
        data <span class="token operator">=</span> data<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">:</span>
            strs <span class="token operator">=</span> strs <span class="token operator">+</span> <span class="token string">"   "</span> <span class="token operator">+</span> data
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">:</span>
            strs <span class="token operator">=</span> strs <span class="token operator">+</span> <span class="token string">"   "</span> <span class="token operator">+</span> data
            list1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>strs<span class="token punctuation">)</span>
            strs <span class="token operator">=</span> <span class="token string">""</span>

    <span class="token keyword">for</span> i<span class="token punctuation">,</span> sitem <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>list1<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>sitem<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># item=item.split("  ")</span>
        item <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\d+'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>
        <span class="token keyword">for</span> j<span class="token punctuation">,</span> one <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># i是序号，one是数值</span>
            npdata<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>one<span class="token punctuation">)</span>
    <span class="token keyword">return</span> npdata
<span class="token comment">#####在原栅格图像周围加一圈并返回</span>
<span class="token keyword">def</span> <span class="token function">AddRound</span><span class="token punctuation">(</span>npgrid<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ny<span class="token punctuation">,</span> nx <span class="token operator">=</span> npgrid<span class="token punctuation">.</span>shape  <span class="token comment"># ny:行数，nx:列数</span>
    zbc<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>ny<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span>nx<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    zbc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>npgrid
    <span class="token comment">#四边</span>
    zbc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>npgrid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    zbc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>npgrid<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    zbc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>npgrid<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
    zbc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>npgrid<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment">#角点</span>
    zbc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>npgrid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
    zbc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>npgrid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    zbc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>npgrid<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
    zbc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>npgrid<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> zbc
<span class="token comment">#####计算xy方向的梯度</span>
<span class="token keyword">def</span> <span class="token function">Cacdxdy</span><span class="token punctuation">(</span>npgrid<span class="token punctuation">,</span>sizex<span class="token punctuation">,</span>sizey<span class="token punctuation">)</span><span class="token punctuation">:</span>
    zbc<span class="token operator">=</span>AddRound<span class="token punctuation">(</span>npgrid<span class="token punctuation">)</span>
    dx<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>zbc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span>zbc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>sizex<span class="token operator">/</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">1000</span>
    dy<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>zbc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span>zbc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>sizey<span class="token operator">/</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">1000</span>
    dx<span class="token operator">=</span>dx<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    dy<span class="token operator">=</span>dy<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    np<span class="token punctuation">.</span>savetxt<span class="token punctuation">(</span><span class="token string">"dxdy.csv"</span><span class="token punctuation">,</span>dx<span class="token punctuation">,</span>delimiter<span class="token operator">=</span><span class="token string">","</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> dx<span class="token punctuation">,</span>dy
<span class="token comment">####计算坡度\坡向</span>
<span class="token keyword">def</span> <span class="token function">CacSlopAsp</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span>dy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    slope<span class="token operator">=</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>arctan<span class="token punctuation">(</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>dx<span class="token operator">*</span>dx<span class="token operator">+</span>dy<span class="token operator">*</span>dy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">57.29578</span>  <span class="token comment">#转换成°</span>
    slope<span class="token operator">=</span>slope<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment">#坡向</span>
    a<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span>dx<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>dx<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>dx<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>dx<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            x<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">(</span>dx<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            y<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">(</span>dy<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token operator">&amp;</span> <span class="token punctuation">(</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>
            <span class="token keyword">elif</span> x<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> y<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">:</span>
                    a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">180</span><span class="token punctuation">.</span>
            <span class="token keyword">elif</span> y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> x<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span>
                    a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">.</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">270</span><span class="token punctuation">.</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>atan<span class="token punctuation">(</span>y<span class="token operator">/</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">57.29578</span>
                <span class="token keyword">if</span> a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">:</span>
                    a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">.</span><span class="token operator">-</span>a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span>
                <span class="token keyword">elif</span> a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">90</span><span class="token punctuation">.</span><span class="token punctuation">:</span>
                    a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">450</span><span class="token punctuation">.</span><span class="token operator">-</span>a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">.</span><span class="token operator">-</span>a<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span>
    <span class="token keyword">return</span> slope<span class="token punctuation">,</span>a
<span class="token comment">####绘制平面栅格图</span>
<span class="token keyword">def</span> <span class="token function">Drawgrid</span><span class="token punctuation">(</span>judge<span class="token punctuation">,</span>pre<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>A<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>strs<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> judge<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> strs <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>A<span class="token punctuation">,</span> interpolation<span class="token operator">=</span><span class="token string">'nearest'</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>hot<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">'lower'</span><span class="token punctuation">)</span>  <span class="token comment"># cmap='bone'  cmap=plt.cm.hot</span>
            plt<span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span>shrink<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>A<span class="token punctuation">,</span> interpolation<span class="token operator">=</span><span class="token string">'nearest'</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span>strs<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">'lower'</span><span class="token punctuation">)</span>  <span class="token comment"># cmap='bone'  cmap=plt.cm.hot</span>
            plt<span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span>shrink<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span>
            xt<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">258000</span><span class="token punctuation">,</span> <span class="token number">268822</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span>
            yt<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">324000</span><span class="token punctuation">,</span> <span class="token number">331222</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> judge<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
        fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
        ax <span class="token operator">=</span> Axes3D<span class="token punctuation">(</span>fig<span class="token punctuation">)</span>
        <span class="token comment"># X = np.arange(1,482,1)</span>
        <span class="token comment"># Y = np.arange(1,322,1)</span>
        X <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">258000.000</span><span class="token punctuation">,</span> <span class="token number">268822.500</span><span class="token punctuation">,</span> <span class="token number">22.5</span><span class="token punctuation">)</span>
        Y <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">324000.000</span><span class="token punctuation">,</span> <span class="token number">331222.500</span><span class="token punctuation">,</span> <span class="token number">22.5</span><span class="token punctuation">)</span>
        X<span class="token punctuation">,</span> Y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span>
        Z <span class="token operator">=</span> pre
        ax<span class="token punctuation">.</span>plot_surface<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> Z<span class="token punctuation">,</span> rstride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> cstride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>get_cmap<span class="token punctuation">(</span><span class="token string">'rainbow'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># cmap=plt.get_cmap('rainbow')</span>
        ax<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> Z<span class="token punctuation">,</span> zdir<span class="token operator">=</span><span class="token string">'z'</span><span class="token punctuation">,</span> offset<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>hot<span class="token punctuation">)</span>
        ax<span class="token punctuation">.</span>set_zlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200000</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="_165"></a>主函数</h3>
<pre><code class="prism language-python"><span class="token keyword">import</span> DEMclass <span class="token keyword">as</span> dem
<span class="token keyword">from</span> DEMclass <span class="token keyword">import</span> Drawgrid
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment">####程序入口</span>
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>
    npgrid<span class="token operator">=</span>dem<span class="token punctuation">.</span>readfile<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pre<span class="token operator">=</span>npgrid
    npgrid<span class="token operator">=</span>dem<span class="token punctuation">.</span>AddRound<span class="token punctuation">(</span>npgrid<span class="token punctuation">)</span>
    dx<span class="token punctuation">,</span>dy<span class="token operator">=</span>dem<span class="token punctuation">.</span>Cacdxdy<span class="token punctuation">(</span>npgrid<span class="token punctuation">,</span><span class="token number">22.5</span><span class="token punctuation">,</span><span class="token number">22.5</span><span class="token punctuation">)</span>
    slope<span class="token punctuation">,</span>arf<span class="token operator">=</span>dem<span class="token punctuation">.</span>CacSlopAsp<span class="token punctuation">(</span>dx<span class="token punctuation">,</span>dy<span class="token punctuation">)</span>
    dem<span class="token punctuation">.</span>np<span class="token punctuation">.</span>savetxt<span class="token punctuation">(</span><span class="token string">"slope.csv"</span><span class="token punctuation">,</span>slope<span class="token punctuation">,</span>delimiter<span class="token operator">=</span><span class="token string">","</span><span class="token punctuation">)</span>
    <span class="token comment">#绘制三维DEM</span>
    Drawgrid<span class="token punctuation">(</span>judge<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>pre<span class="token operator">=</span>pre<span class="token punctuation">)</span>
    <span class="token comment">#绘制二维DEM</span>
    Drawgrid<span class="token punctuation">(</span>judge<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>A<span class="token operator">=</span>pre<span class="token punctuation">,</span>strs<span class="token operator">=</span><span class="token string">"bone"</span><span class="token punctuation">)</span>
    <span class="token comment">#绘制坡度图</span>
    Drawgrid<span class="token punctuation">(</span>judge<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>A<span class="token operator">=</span>slope<span class="token punctuation">,</span>strs<span class="token operator">=</span><span class="token string">"rainbow"</span><span class="token punctuation">)</span>
    <span class="token comment">#绘制坡向图</span>
    Drawgrid<span class="token punctuation">(</span>judge<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>A<span class="token operator">=</span>arf<span class="token punctuation">)</span>
</code></pre>
<h2><a id="_188"></a>效果图</h2>
<p>三维图：<br>
<img src="https://img-blog.csdnimg.cn/20200610234752608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU2MTM1Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
二维DEM：<br>
<img src="https://img-blog.csdnimg.cn/20200610234806344.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU2MTM1Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
坡度图：<br>
<img src="https://img-blog.csdnimg.cn/20200610234819846.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU2MTM1Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
坡向图：<br>
<img src="https://img-blog.csdnimg.cn/20200610234831418.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU2MTM1Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2><a id="_197"></a>参考资料</h2>
<blockquote>
<p>1.Python的地形三维可视化——简介Matplotlib和gdal<br>
https://blog.csdn.net/allenlu2008/article/details/51880333<br>
2.Pycharm中配置GDAL库的一种方法<br>
https://blog.csdn.net/qq_35960361/article/details/96438650<br>
3.python 调用gdal 处理dem数据<br>
https://blog.csdn.net/qq_15642411/article/details/79123677<br>
4.适用于Python扩展程序包的非官方Windows二进制文件——GDAL<br>
https://www.lfd.uci.edu/~gohlke/pythonlibs/#gdal<br>
5.python gdal安装与简单使用<br>
https://blog.csdn.net/nima1994/article/details/79207805/<br>
pip install GDAL-2.4.1-cp37-cp37m-win_amd64.whl<br>
6.（目测有用）【GDAL】python读取DEM计算坡度与坡向<br>
https://blog.csdn.net/qq_37935516/article/details/85028979<br>
7.arcgis计算坡度、坡向<br>
http://help.arcgis.com/zh-cn/arcgisdesktop/10.0/help/index.html#//009z000000vz000000<br>
8.C语言实现GDAL使用DEM数据计算坡度坡向<br>
https://blog.csdn.net/liminlu0314/article/details/8498985<br>
9.gdal在python功能（官方）<br>
https://gdal.org/python/index.html<br>
10.玩转python的正则表达式|提取字符串中的所有数字<br>
https://blog.csdn.net/guanyonglai/article/details/89512659<br>
https://blog.csdn.net/u011436427/article/details/82628597<br>
可视化<br>
1.三维图（目测有用）<br>
https://blog.51cto.com/9291927/2435621<br>
2.地图+热力图（可以用于坡度坡向）<br>
https://www.zhihu.com/question/33783546<br>
3.统计<br>
https://www.cnblogs.com/dudududu/p/9149762.html<br>
4.turtle库<br>
https://blog.csdn.net/weixin_44078196/article/details/10065651</p>
</blockquote>
</div>
</body>

</html>
